#!/usr/bin/env bash

if [ $1 = "C" ]  
then  
    /usr/bin/gcc -ggdb main.c -std=c99 -Wall -Werror -o program && /usr/local/bin/valgrind ./program
elif [ $1 = "Cpp" ]  
then  
    /usr/bin/g++ -g -fPIC -std=c++11 main.cpp src/iris.h src/API.cpp src/utils/tools/city.h src/utils/tools/city.cc  src/utils/tools/Buffer.cpp src/utils/tools/Buffer.h src/POSIX.cpp src/POSIX.h src/S3.cpp src/S3.h src/HDF5.cpp src/HDF5.h src/metadata_manager/MetadataManagerFactory.cpp src/metadata_manager/MetadataManagerFactory.h src/utils/caching/CacheManager.cpp src/utils/caching/CacheManager.h src/API.h src/metadata_manager/IrisMetadataManager.cpp src/metadata_manager/IrisMetadataManager.h src/metadata_manager/POSIXMetadataManager.cpp src/metadata_manager/POSIXMetadataManager.h src/metadata_manager/HDF5MetadataManager.cpp src/metadata_manager/HDF5MetadataManager.h src/metadata_manager/S3MetadataManager.cpp src/metadata_manager/S3MetadataManager.h src/mapper/MapperFactory.cpp src/mapper/MapperFactory.h src/mapper/AbstractMapper.cpp src/mapper/AbstractMapper.h src/mapper/posix/POSIXMapper.cpp src/mapper/posix/POSIXMapper.h src/mapper/s3/S3Mapper.cpp src/mapper/s3/S3Mapper.h src/config/constants.h src/utils/prefetching/PrefetcherFactory.cpp src/utils/prefetching/PrefetcherFactory.h src/utils/prefetching/AbstractPrefetcher.cpp src/utils/prefetching/AbstractPrefetcher.h src/utils/prefetching/FileSystemPrefetcher.cpp src/utils/prefetching/FileSystemPrefetcher.h src/utils/prefetching/ObjectStorePrefetcher.cpp src/utils/prefetching/ObjectStorePrefetcher.h src/utils/aggregation/AggregatorFactory.cpp src/utils/aggregation/AggregatorFactory.h src/utils/aggregation/AbstractAggregator.cpp src/utils/aggregation/AbstractAggregator.h src/utils/aggregation/FileSystemAggregator.cpp src/utils/aggregation/FileSystemAggregator.h src/utils/aggregation/ObjectStoreAggregator.cpp src/utils/aggregation/ObjectStoreAggregator.h src/mapper/HDF5Mapper.cpp src/mapper/HDF5Mapper.h src/file_systems/FileSystemFactory.cpp src/file_systems/FileSystemFactory.h src/file_systems/AbstractFileSystem.cpp src/file_systems/AbstractFileSystem.h src/file_systems/PVFS2Client.cpp src/file_systems/PVFS2Client.h src/object_stores/ObjectStoreFactory.cpp src/object_stores/ObjectStoreFactory.h src/object_stores/AbstractObjectStore.cpp src/object_stores/AbstractObjectStore.h src/object_stores/HyperdexClient.cpp src/object_stores/HyperdexClient.h src/config/return_codes.h testing/local_tests.cpp testing/local_tests.h src/utils/tools/Timer.cpp src/utils/tools/Timer.h src/mapper/posix/POSIXMapperGetOptimised.cpp src/mapper/posix/POSIXMapperGetOptimised.h src/mapper/posix/POSIXMapperPutOptimised.cpp src/mapper/posix/POSIXMapperPutOptimised.h src/object_stores/HyperdexClientPutOptimised.cpp src/object_stores/HyperdexClientPutOptimised.h src/object_stores/HyperdexClientGetOptimised.cpp src/object_stores/HyperdexClientGetOptimised.h src/utils/caching/LRU.cpp src/utils/caching/LRU.h src/utils/caching/LFU.cpp src/utils/caching/LFU.h src/utils/caching/AbstractReplacementPolicy.cpp src/utils/caching/AbstractReplacementPolicy.h src/object_stores/MongoDBClient.cpp src/object_stores/MongoDBClient.h src/utils/tools/AssertUtil.h src/config/ConfigurationManager.cpp src/config/ConfigurationManager.h src/config/Components.h src/mapper/s3/S3MapperNaive.cpp src/mapper/s3/S3MapperNaive.h src/mapper/s3/S3MapperNaiveOptimized.cpp src/mapper/s3/S3MapperNaiveOptimized.h src/mapper/s3/S3MapperOptimized.cpp src/mapper/s3/S3MapperOptimized.h src/file_systems/PVFS2ClientNonBlocking.cpp src/file_systems/PVFS2ClientNonBlocking.h testing/replayers/trace_replayer.cpp testing/replayers/trace_replayer.h -L/usr/lib/ -lhyperdex-client -lhyperdex-admin -L/opt/orangefs/lib -lorangefsposix -fno-builtin-malloc -fno-builtin-free -L/usr/lib/ -ltcmalloc -I/usr/local/include/mongocxx/v_noabi -I/usr/local/include/libmongoc-1.0 -I/usr/local/include/bsoncxx/v_noabi -I/usr/local/include/libbson-1.0 -L/usr/local/lib -lmongocxx -lbsoncxx -I/opt/hdf5/include -L/opt/hdf5/lib -lhdf5 -L/opt/hdf5/lib -lhdf5_hl -ldl -DIRIS -o program && /usr/bin/valgrind --leak-check=full --show-leak-kinds=all --track-origins=yes ./program
fi
